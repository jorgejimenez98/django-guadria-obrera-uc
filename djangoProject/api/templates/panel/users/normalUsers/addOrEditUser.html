{% extends 'panel/master.html' %}
{% load static %}
{% load tagsFunctions %}

{% block headerBlock %}
    {% if user is not None %}
        <title>GOE | Panel | Editar Usuario</title>
    {% else %}
        <title>GOE | Panel | Insertar Usuario</title>
    {% endif %}
    <script src="{% static 'panel/js/pages/myPages/users/addValidation.js' %}"></script>
{% endblock %}


{% block mainBlock %}
    <div class="content  d-flex flex-column flex-column-fluid" id="kt_content"
         style="background: url('{% static 'public/images/footer-bg.jpg' %}') repeat fixed; background-size: 100% 100%; border-top-left-radius: 90% !important;">
        <!--begin::Subheader-->
        <div class="subheader py-2 py-lg-6  subheader-transparent " id="kt_subheader">
            <div class=" container  d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
                <!--begin::Info-->
                <div class="d-flex align-items-center flex-wrap mr-1">

                    <!--begin::Page Heading-->
                    <div class="d-flex align-items-baseline flex-wrap mr-5">
                        <!--begin::Page Title-->
                        <ul class="breadcrumb breadcrumb-transparent breadcrumb-dot font-weight-bold p-0 my-2 font-size-sm">
                            <li class="breadcrumb-item">
                                <a href="/panel/users/" class="text-muted">
                                    Tabla de Gestión
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <span class="text-muted disabled">
                                    {% if user is not None %}
                                        Editar
                                    {% else %}
                                        Insertar
                                    {% endif %}
                                </span>
                            </li>
                        </ul>
                        <!--end::Page Title-->
                    </div>
                    <!--end::Page Heading-->
                    <div class="d-flex align-items-center flex-wrap mr-1">

                        <!--begin::Page Heading-->
                    </div>
                </div>
                <!--end::Info-->

                <!--begin::Toolbar-->
                <div class="d-flex align-items-center">
                    <a href="#" class="btn btn-bg-white font-weight-bold mr-3 my-2 my-lg-0" data-toggle="tooltip">
                        <span class="text-muted font-weight-bold mr-2"
                              id="kt_dashboard_daterangepicker_title">Día de Hoy</span>
                        <span class="text-primary font-weight-bolder"
                              id="kt_dashboard_daterangepicker_date">{{ today }}</span>
                    </a>
                </div>
                <!--end::Toolbar-->
            </div>
        </div>
        <!--end::Subheader-->

        <div class="container">
            <div class="alert alert-custom alert-white alert-shadow gutter-b" role="alert">
                <div class="alert-icon">
                    <i class="la la-info-circle icon-3x"></i>
                </div>
                <div class="alert-text">
                    Nota para el <strong>Administrador</strong>: Tenga en cuenta que si desea gestionar usuarios del
                    tipo (<strong>Decano</strong>, <strong>PPAA</strong>, <strong>Jefe de Departamento</strong> y
                    <strong>Programador Facultad</strong>) debe insertar el usuario deseado como un usuario normal
                    <strong>(Estudiante/Trabajador)</strong> para luego ir a la parte de la Administración del Sistema
                    donde puede gestionar este tipo de usuarios asignándole a cada uno los datos únicos que va a tener
                    este usuario.
                </div>
            </div>
        </div>

        <div class="d-flex flex-column-fluid">
            <!--begin::Container-->
            <div class=" container ">
                <form action="{% if user is not None %}
                                  {% url 'editUser' pk=user.pk %}
                              {% else %}
                                  {% url 'addUser' %}
                              {% endif %}"
                      method="post" id="submitForm" class="form">
                    {% csrf_token %}
                    <!--begin::Card-->
                    <div class="card card-custom" style="box-shadow: 0 0 10px 5px #1BC5BD;">
                        <div class="card-header flex-wrap border-0 pt-6 pb-0">
                            <div class="card-title">
                                <h3 class="card-label">
                                    Formulario para gestionar Usuarios del sistema
                                    <span class="text-muted pt-2 font-size-sm d-block">
                                        Gestione los datos.
                                    </span>
                                </h3>
                            </div>
                            <div class="card-toolbar">
                                <h2 class="text-muted">
                                    {% if user is not None %}
                                        Editar &nbsp;
                                    {% else %}
                                        Insertar &nbsp
                                    {% endif %}
                                </h2>
                                <i class="la la-user-edit icon-lg-3x"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="container">

                                {% if messages %}
                         {% for message in messages %}
                                <div class="alert alert-custom
                                            {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %} alert-light-danger
                                            {% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %} alert-light-success
                                            {% endif %} fade show mb-5 animated bounce"
                                    role="alert" style="box-shadow: 0 0 2px 2px darkgrey;">
                                <div class="alert-icon">
                                    <i class="{% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                                                  flaticon-danger
                                              {% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                                                  flaticon2-check-mark
                                              {% endif %}"></i>
                                </div>
                                <div class="alert-text">
                                    <h3 class="font-weight-bold"><strong>{{ message }}</strong></h3>
                                </div>
                                <div class="alert-close">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true"><i class="ki ki-close"></i></span>
                                    </button>
                                </div>
                            </div>
                         {% endfor %}
                    {% endif %}

                                <hr>
                                <br>
                                <h3 class="text-muted text-left">Datos personales</h3>
                                <br>

                                <div class="form-group row fv-plugins-icon-container">
                                    <label for="username" class="col-form-label text-left col-lg-3 col-sm-12">
                                        <span class="badge badge-light">1</span>&nbsp;Nombre de Usuario
                                    </label>
                                    <div class="col-lg-9 col-md-9 col-sm-12">
                                        <input type="text" class="form-control" name="username" id="username"
                                               aria-describedby="helpId"
                                               {% if user is not None %}
                                                   value="{{ user.username }}"
                                                   placeholder="Valor Anterior: {{ user.username }}"
                                               {% else %}
                                                   placeholder="Escribe aquí el nombre de usuario"
                                               {% endif %}>
                                        <div class="fv-plugins-message-container"></div>
                                    </div>
                                </div>

                                <div class="form-group row fv-plugins-icon-container">
                                    <label for="names" class="col-form-label text-left col-lg-3 col-sm-12">
                                        <span class="badge badge-light">2</span>&nbsp;Nombres
                                    </label>
                                    <div class="col-lg-9 col-md-9 col-sm-12">
                                        <input type="text" class="form-control" name="names" id="names"
                                               aria-describedby="helpId"
                                               {% if user is not None %}
                                                   value="{{ user.first_name }}"
                                                   placeholder="Valor anterior: {{ user.first_name }}"
                                               {% else %}
                                                   placeholder="Escribe aquí el nombre"
                                               {% endif %}>
                                        <div class="fv-plugins-message-container"></div>
                                    </div>
                                </div>

                                <div class="form-group row fv-plugins-icon-container">
                                    <label for="lastNames" class="col-form-label text-left col-lg-3 col-sm-12">
                                        <span class="badge badge-light">3</span>&nbsp;Apellidos
                                    </label>
                                    <div class="col-lg-9 col-md-9 col-sm-12">
                                        <input type="text" class="form-control" name="lastNames" id="lastNames"
                                               aria-describedby="helpId"
                                               {% if user is not None %}
                                                   value="{{ user.last_name }}"
                                                   placeholder="Valor Anterior: {{ user.last_name }}"
                                                {% else %}
                                                    placeholder="Escribe aquí los apellidos"
                                                {% endif %}>
                                        <div class="fv-plugins-message-container"></div>
                                    </div>
                                </div>

                                <div class="form-group row fv-plugins-icon-container">
                                    <label class="col-form-label text-left col-lg-3 col-sm-12"
                                           for="email">
                                        <span class="badge badge-light">4</span>Correo
                                    </label>
                                    <div class="col-lg-9 col-md-9 col-sm-12">
                                        <input type="text" class="form-control" name="email" id="email"
                                               {% if user is not None %}
                                                   value="{{ user.email }}"
                                                   placeholder="Valor Anterior: {{ user.email }}"
                                               {% else %}
                                                   placeholder="Escribe aquí el nombre de correo"
                                               {% endif %}>
                                        <div class="fv-plugins-message-container"></div>
                                    </div>
                                </div>

                                <div class="form-group row fv-plugins-icon-container">
                                    <label class="col-form-label text-left col-lg-3 col-sm-12" for="rol">
                                        <span class="badge badge-light">5</span>&nbsp;Seleccione un Rol de Usuario
                                    </label>
                                    <div class="col-lg-9 col-md-9 col-sm-12">
                                        <select class="form-control selectpicker" name="rol" id="rol"
                                                data-size="7">
                                            {% if user is not None %}
                                                <option value="{{ user | getGroup }}">{{ user | getGroup }}</option>
                                                {% if user|getGroup != 'Administrador' %}
                                                <option value="Administrador">Administrador</option>
                                                {% endif %}
                                                {% if user|getGroup != 'OGS' %}
                                                    <option value="OGS">Oficial de Guardia Superior</option>
                                                {% endif %}
                                                {% if user|getGroup != 'Estudiante-Trabajador' %}
                                                    <option value="Estudiante-Trabajador">Estudiante/Trabajador</option>
                                                {% endif %}
                                                {% if user|getGroup != 'Programador UC' %}
                                                    <option value="Programador UC">Programador UC</option>
                                                {% endif %}
                                            {% else %}
                                                <option value="">Seleccione</option>
                                                <option value="Administrador">Administrador</option>
                                                <option value="OGS">Oficial de Guardia Superior</option>
                                                <option value="Estudiante-Trabajador">Estudiante/Trabajador</option>
                                                <option value="Programador UC">Programador UC</option>
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>

                                {% if user is None %}
                                    <hr>
                                    <br>
                                    <h3 class="text-muted text-left">Confirmar cuenta de usuario</h3>
                                    <br>
                                    <div class="form-group row fv-plugins-icon-container">
                                    <label for="password" class="col-form-label text-left col-lg-3 col-sm-12">
                                        <span class="badge badge-light">6</span>&nbsp;Contraseña
                                    </label>
                                    <div class="col-lg-9 col-md-9 col-sm-12">
                                        <input type="password" class="form-control" name="password" id="password"
                                               aria-describedby="helpId"
                                               placeholder="Escribe aquí">
                                        <div class="fv-plugins-message-container"></div>
                                    </div>
                                </div>

                                    <div class="form-group row fv-plugins-icon-container">
                                    <label for="confirmPassword" class="col-form-label text-left col-lg-3 col-sm-12">
                                        <span class="badge badge-light">7</span>&nbsp;Confirmar contraseña
                                    </label>
                                    <div class="col-lg-9 col-md-9 col-sm-12">
                                        <input type="password" class="form-control" name="confirmPassword"
                                               id="confirmPassword"
                                               aria-describedby="helpId"
                                               placeholder="Escribe">
                                        <div class="fv-plugins-message-container"></div>
                                    </div>
                                </div>
                                {% endif %}

                                <div class="mr-2 text-right">
                                    <button type="submit" class="btn btn-light-primary font-weight-bolder float-right">
                                        <span class="svg-icon svg-icon-md"><!--begin::Svg Icon | path:assets/media/svg/icons/Design/PenAndRuller.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><rect x="0" y="0" width="24" height="24"></rect><path d="M3,16 L5,16 C5.55228475,16 6,15.5522847 6,15 C6,14.4477153 5.55228475,14 5,14 L3,14 L3,12 L5,12 C5.55228475,12 6,11.5522847 6,11 C6,10.4477153 5.55228475,10 5,10 L3,10 L3,8 L5,8 C5.55228475,8 6,7.55228475 6,7 C6,6.44771525 5.55228475,6 5,6 L3,6 L3,4 C3,3.44771525 3.44771525,3 4,3 L10,3 C10.5522847,3 11,3.44771525 11,4 L11,19 C11,19.5522847 10.5522847,20 10,20 L4,20 C3.44771525,20 3,19.5522847 3,19 L3,16 Z" fill="#000000" opacity="0.3"></path><path d="M16,3 L19,3 C20.1045695,3 21,3.8954305 21,5 L21,15.2485298 C21,15.7329761 20.8241635,16.200956 20.5051534,16.565539 L17.8762883,19.5699562 C17.6944473,19.7777745 17.378566,19.7988332 17.1707477,19.6169922 C17.1540423,19.602375 17.1383289,19.5866616 17.1237117,19.5699562 L14.4948466,16.565539 C14.1758365,16.200956 14,15.7329761 14,15.2485298 L14,5 C14,3.8954305 14.8954305,3 16,3 Z" fill="#000000"></path></g></svg><!--end::Svg Icon--></span>
                                        {% if user is not None %}
                                            Editar
                                        {% else %}
                                            Insertar
                                        {% endif %}
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!--end::Card-->
                </form>
            </div>
            <!--end::Container-->
        </div>

    </div>

{% endblock %}

{% block footerBlock %}
    <script src="{% static 'panel/js/pages/crud/forms/widgets/bootstrap-select.js' %}"></script>
{% endblock %}

